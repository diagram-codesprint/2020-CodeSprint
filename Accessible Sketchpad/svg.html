<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      svg {
        display: block;
        width: 500px;
        height: 500px;
        fill: none;
      }
    </style>

    <script src="Shapes/Circle.js"></script>
    <script>
      const CURRENT_ID = "current-shape";
      let sketchpad;
      let inputCenterX;
      let inputCenterY;
      let inputRadius;
      let currentCircle;

      const getRandomColor = () => {
        var letters = "0123456789ABCDEF";
        var color = "#";
        for (var i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      };

      const keyboardMove = (e) => {
        let input;
        let delta;
        const multiplier = e.shiftKey ? 5 : 1;
        switch (e.key) {
          case "ArrowUp":
            delta = -1;
            input = inputCenterY;
            break;
          case "ArrowRight":
            delta = 1;
            input = inputCenterX;
            break;
          case "ArrowDown":
            delta = 1;
            input = inputCenterY;
            break;
          case "ArrowLeft":
            delta = -1;
            input = inputCenterX;
            break;
          case "=":
          case "+":
            input = inputRadius;
            delta = 1;
            break;
          case "-":
          case "_":
            input = inputRadius;
            delta = -1;
            break;
        }
        if (input && delta) {
          input.value = Math.min(
            input.max,
            Math.max(input.min, parseInt(input.value, 10) + delta * multiplier)
          );
          currentCircle.draw({ [input.id]: input.value });
        }
      };

      const setCurrent = (circle) => {
        sketchpad.querySelector("title").textContent = circle.label;
        inputCenterX.value = circle.centerX;
        inputCenterY.value = circle.centerY;
        inputRadius.value = circle.radius;
        currentCircle = circle;
      };

      const createCircle = () => {
        const circle = Circle.create(sketchpad, {
          centerX: inputCenterX.value,
          centerY: inputCenterY.value,
          radius: inputRadius.value,
        });
        circle.shape.id = CURRENT_ID;
        circle.shape.setAttribute("style", `color: ${getRandomColor()}`);
        circle.shape.addEventListener("keydown", keyboardMove);
        circle.shape.addEventListener("focus", () => setCurrent(circle));
        setCurrent(circle);
      };

      function onInput() {
        currentCircle.draw({ [this.id]: this.value });
      }

      function addShape() {
        currentCircle.shape.id = null;
        createCircle();
      }

      window.onload = () => {
        sketchpad = document.getElementById("sketchpad");
        inputCenterX = document.getElementById("centerX");
        inputCenterY = document.getElementById("centerY");
        inputRadius = document.getElementById("radius");
        createCircle();
      };
    </script>
    <title>SVG Version of Drawing Sketchpad</title>
  </head>
  <body>
    <h2 id="sketchpad-label">Sketchpad</h2>
    <svg
      id="sketchpad"
      viewBox="0 0 100 100"
      xmlns="http://www.w3.org/2000/svg"
    ><title></title></svg>

    <h2>Drawing Controls</h2>
    <div id="controls">
      <form>
        <label for="radius">Radius</label>
        <input
          oninput="onInput.call(this)"
          id="radius"
          type="number"
          min="0"
          max="100"
          value="25"
        />
        <label for="centerX">Center X</label>
        <input
          oninput="onInput.call(this)"
          id="centerX"
          type="number"
          min="0"
          max="100"
          value="50"
        />
        <label for="centerY">Center Y</label>
        <input
          oninput="onInput.call(this)"
          id="centerY"
          type="number"
          min="0"
          max="100"
          value="50"
        />

        <button onClick="addShape()" type="button">Save and Add Another</button>
      </form>
    </div>
  </body>
</html>
